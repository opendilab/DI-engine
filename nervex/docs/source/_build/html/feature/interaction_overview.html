

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Interaction Overview &mdash; nerveX 0.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link href="../_static/css/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> nerveX
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concept/index.html">Key Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro_rl/index.html">Introduction to RL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hands_on/index.html">Hands on RL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../best_practice/index.html">Best Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/index.html">API Doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supplementary_rl/index.html">Supplementary of RL</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_dev/index.html">Tutorial-Developer</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">nerveX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Interaction Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/feature/interaction_overview.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="interaction-overview">
<span id="header-n0"></span><h1>Interaction Overview<a class="headerlink" href="#interaction-overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="header-n2">
<span id="id1"></span><h2>概述<a class="headerlink" href="#header-n2" title="Permalink to this headline">¶</a></h2>
<p>Interaction为一个独立于任何具体业务的交互式服务框架，用于支持简单非阻塞单线程任务。在nerveX中为分布式环境下的多机多卡训练提供支持。</p>
<p>Interaction分为两个端，是Master端和Slave端，分别为任务下达端和任务执行端。</p>
</div>
<div class="section" id="slave">
<span id="header-n9"></span><h2>Slave端<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h2>
<p>Slave端的任务是从Master端接收任务信息，通过重写<code class="docutils literal notranslate"><span class="pre">_process_task</span></code>方法来执行任务，并通过返回值以及异常抛出来进行消息回传。</p>
<p>一个简单的例子，可以通过如下的方式来构建属于自己的<code class="docutils literal notranslate"><span class="pre">Slave</span></code>类：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySlave</span><span class="p">(</span><span class="n">Slave</span><span class="p">):</span>  <span class="c1"># build a slave class, inheriting from Slave base class</span>
    <span class="k">def</span> <span class="nf">_process_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="k">if</span> <span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TaskFail</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;ab not found&#39;</span><span class="p">},</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;A or B not found in task data.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>这个类的业务逻辑为，如果<code class="docutils literal notranslate"><span class="pre">a</span></code>和<code class="docutils literal notranslate"><span class="pre">b</span></code>参数全部存在，则以json格式返回两者的和，不然通过抛出<code class="docutils literal notranslate"><span class="pre">TaskFail</span></code>异常来表示任务执行失败。</p>
<p>而对于Slave类的调用，有两种方式。首先是通过常规方式启动和关闭slave端：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">slave</span> <span class="o">=</span> <span class="n">MySlave</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">233</span><span class="p">)</span>  <span class="c1"># instantiate new slave instance</span>
<span class="n">slave</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># start the slave end</span>

<span class="c1"># do something here</span>

<span class="n">slave</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>  <span class="c1"># shutdown the slave (ATTENTION: slave will not be stopped immediately after this)</span>
<span class="n">slave</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>  <span class="c1"># wait until the slave completely stopped</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;slave has been stopped&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>或者通过<code class="docutils literal notranslate"><span class="pre">with</span></code>进行快速调用</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">MySlave</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">233</span><span class="p">):</span>  <span class="c1"># start the slave</span>
    <span class="c1"># when this line is reached, all the initialization process has been completed</span>
    <span class="n">run_until_ctrl_c</span><span class="p">()</span>  <span class="c1"># just block here</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;slave has been stopped&quot;</span><span class="p">)</span>  <span class="c1"># after quit the slave with block, all the resources will be automatically released, and wait until slave completely stopped</span>
</pre></div>
</div>
<p>通过上述调用后，在<code class="docutils literal notranslate"><span class="pre">master</span></code>端连接<code class="docutils literal notranslate"><span class="pre">slave</span></code>的8080端口，选择频道<code class="docutils literal notranslate"><span class="pre">233</span></code>即可完成连接。</p>
<p>值得注意的是：</p>
<ul class="simple">
<li><p>为了方便对任务逻辑的实现，<strong>请继承Slave类并实现``_task_process``方法</strong>，不要直接使用Slave类创建Slave端。</p></li>
<li><p>关于channel，可以视为对不同具体业务的一种标识，其概念类似于无线电频道、网络端口等。<strong>建议对于特定的业务设定特定的channel值</strong>，不要直接使用0或缺省等容易碰撞的值，以确保当发生误连的时候可以立刻得到反馈。</p></li>
</ul>
</div>
<div class="section" id="master">
<span id="header-n57"></span><h2>Master端<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h2>
<p>Master端的主要任务是对Slave端进行连接，并通过建立的连接对Slave进行任务的下达和接收。</p>
<p>一个简单的例子，可以通过如下方式来构建属于自己的<code class="docutils literal notranslate"><span class="pre">Master</span></code>类：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyMaster</span><span class="p">(</span><span class="n">Master</span><span class="p">):</span>  <span class="c1"># build a master class, inherit from master base class</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>与Slave类似，Master端有两种启动方式。首先是通过常规方式启动和停止Master：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">master</span> <span class="o">=</span> <span class="n">MyMaster</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8088</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">233</span><span class="p">)</span>  <span class="c1"># instantiate new master instance</span>
<span class="n">master</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># start the master end</span>

<span class="c1"># do something here</span>

<span class="n">master</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>  <span class="c1"># shutdown the master (ATTENTION: master will not be stopped immediately)</span>
<span class="n">master</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>  <span class="c1"># wait until the master completely stopped</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;master has been stopped&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>或通过<code class="docutils literal notranslate"><span class="pre">with</span></code>进行快速调用：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">MyMaster</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8088</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">233</span><span class="p">)</span> <span class="k">as</span> <span class="n">master</span><span class="p">:</span>  <span class="c1"># start the master</span>
    <span class="c1"># when this line is reached, all the initialization process has been completed</span>
    <span class="c1"># do anything you like here</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;master has been stopped&quot;</span><span class="p">)</span>  <span class="c1"># after quit the master with block, all the resources will be automatically released, and wait until master completely stopped</span>
</pre></div>
</div>
<p>基于<code class="docutils literal notranslate"><span class="pre">with</span></code>的使用，我们可以通过以下方式进行任务的下达、管理以及结果的获取。结合上文中Slave的例子，举例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyMaster</span><span class="p">(</span><span class="n">Master</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
     <span class="k">with</span> <span class="n">MyMaster</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8088</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">233</span><span class="p">)</span> <span class="k">as</span> <span class="n">master</span><span class="p">:</span>
        <span class="n">master</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>  <span class="c1"># True if master launch success, otherwise False</span>

        <span class="k">with</span> <span class="n">master</span><span class="o">.</span><span class="n">new_connection</span><span class="p">(</span><span class="s1">&#39;conn&#39;</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>  <span class="c1"># establish a connection to slave end</span>
            <span class="c1"># when this line is reached, all the initialization process has been completed</span>

            <span class="k">assert</span> <span class="n">conn</span><span class="o">.</span><span class="n">is_connected</span>  <span class="c1"># check if slave connected success</span>

            <span class="k">assert</span> <span class="s1">&#39;conn&#39;</span> <span class="ow">in</span> <span class="n">master</span>  <span class="c1"># check if connection &#39;conn&#39; still exist and alive in master</span>
            <span class="n">_tmp_conn</span> <span class="o">=</span> <span class="n">master</span><span class="p">[</span><span class="s1">&#39;conn&#39;</span><span class="p">]</span>  <span class="c1"># get connection named &#39;conn&#39; from master</span>
            <span class="k">assert</span> <span class="n">conn</span> <span class="o">==</span> <span class="n">_tmp_conn</span>  <span class="c1"># of course, one object actually</span>

            <span class="n">task</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">new_task</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>  <span class="c1"># create a new task (but has not been sent to slave yet)</span>
            <span class="n">task</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>  <span class="c1"># start the task and waiting for its completeness</span>
            <span class="k">assert</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>  <span class="c1"># get result of task</span>
            <span class="k">assert</span> <span class="n">task</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">COMPLETED</span>  <span class="c1"># get status of task</span>

            <span class="n">task</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">new_task</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>  <span class="c1"># create a new invalid task</span>
            <span class="n">task</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;ab not found&#39;</span><span class="p">}</span>  <span class="c1"># get result of task failure</span>
            <span class="k">assert</span> <span class="n">task</span><span class="o">.</span><span class="n">result</span> <span class="o">==</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">FAILED</span>  <span class="c1"># get status of task</span>

            <span class="n">_result_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">def</span> <span class="nf">_print_result</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
                <span class="k">nonlocal</span> <span class="n">_result_value</span>
                <span class="n">_result_value</span> <span class="o">=</span> <span class="n">result</span>

                     <span class="n">task</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">new_task</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span><span class="o">.</span><span class="n">on_complete</span><span class="p">(</span><span class="n">_print_result</span><span class="p">)</span>  <span class="c1"># create a new task with callback</span>
            <span class="n">task</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">_result_value</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>  <span class="c1"># the callback has been triggered</span>
</pre></div>
</div>
<p>此外，还有更多的一些功能和用法，后续会考虑进一步介绍，同时欢迎阅读源代码。</p>
<p>值得注意的有以下几点：</p>
<ul class="simple">
<li><p>为了方便对功能的扩展，<strong>请继承Master类，且在需要的时候实现诸如``_before_new_task``等的一系列方法</strong>，不要直接使用Master类创建Master端。</p></li>
<li><p><strong>Master和Slave端的channel务必设置为同一个整数</strong>，否则将导致无法正常建立连接。</p></li>
</ul>
</div>
<div class="section" id="header-n54">
<span id="id2"></span><h2>常见问题<a class="headerlink" href="#header-n54" title="Permalink to this headline">¶</a></h2>
<div class="section" id="q">
<span id="header-n13"></span><h3>Q：何为非阻塞单线程任务？以及何故作此设计？<a class="headerlink" href="#q" title="Permalink to this headline">¶</a></h3>
<p>A：即为<strong>当Master端下达任务时，如果Slave端空闲，则执行任务；若果Slave端已经有一个任务正在运行，则拒绝该任务请求</strong>。</p>
<p>与之类似的也有类似几个任务模式，定义如下：</p>
<ul class="simple">
<li><p>非阻塞多线程任务：Slave端设有最大任务数量，当Master下达任务时，如果正在执行的任务已经达到最大数量，则拒绝新任务请求。</p></li>
<li><p>阻塞单线程任务：当Master端下达任务时，如果Slave端空闲，则执行任务；若果Slave端已经有一个任务正在运行，则将新任务加入任务队列，等待之前的任务完成后再执行。</p></li>
<li><p>阻塞多线程任务：Slave端设有最大任务数量，当Master下达任务时，如果正在执行的任务已经达到最大数量，则将新任务加入任务队列，等待之前的任务完成后再执行。</p></li>
</ul>
<p>考虑到<strong>强化学习训练并发计算量大，不宜在节点上分散算力</strong>，且需要方便业务层调度管理的实际需求，故此处设计为非阻塞单线程任务模式。</p>
</div>
<div class="section" id="q-interaction">
<span id="header-n122"></span><h3>Q：Interaction模块适合使用的问题有哪些？<a class="headerlink" href="#q-interaction" title="Permalink to this headline">¶</a></h3>
<p>A：实际上根据目前的初步调研，训练任务会分为如下几种情况：</p>
<ul class="simple">
<li><p><strong>单机轻型</strong>。即在单个具备或不具备GPU的普通计算机上进行训练任务，例如在自己的工作机、笔记本上运行demo。</p></li>
<li><p><strong>单机分布式</strong>。即在单个算力较高的计算机或集群上进行训练任务，例如在配备GPU的高配工作站、常见的slurm集群等环境上运行一般的训练任务。</p></li>
<li><p><strong>多机规模化分布式</strong>。即在多个计算节点上进行协同训练任务，例如在处于共同内网的100台GPU服务器上运行一个具备规模的训练任务。</p></li>
</ul>
<p>实际上对于单机轻型来说，一般的运行即可完成；而<strong>对于单机分布式而言，Interaction是完全不必要的</strong>，因为单机分布式环境下完全可以通过fork开启子进程的方式启动各端，并通过进程锁（Lock）和事件（Event）进行阻塞控制，其传输性能和稳定性必然超过基于http服务的Interaction。</p>
<p>因此<strong>对于Interaction而言，真正的优势环境为多机规模化分布式环境</strong>，具体来说，因为在多机环境下开启fork或者基于远程启动来启动训练任务是不现实的，因而必须基于Interaction构建服务体系。并且实际上在这样的环境下，<strong>最佳实践为预先开启全部的服务节点（即Slave节点），保持长期待机状态，并有专人对这些算力进行维护（类比对slurm集群的维护），当有使用者有训练任务时，会对现有大量节点进行连接，安排并运行训练任务</strong>。</p>
</div>
<div class="section" id="q-masterslave">
<span id="header-n120"></span><h3>Q：Master和Slave在发送网络请求时出现错误，抛出异常，应该如何处理？<a class="headerlink" href="#q-masterslave" title="Permalink to this headline">¶</a></h3>
<p>A：抛出的网络请求异常在Interaction框架中，基于错误代码（非HTTP状态码）进行了异常类的归类。在实际使用的时候请<strong>注意不要直接使用HTTPError进行异常的捕捉</strong>，该异常只能捕捉非业务异常（例如DNS故障、连接超时等），而对于业务异常，请使用对应的异常类已经捕捉，并且<strong>建议根据不同的业务异常类型使用对应的异常类</strong>，以实现精确捕捉和处理问题。</p>
</div>
<div class="section" id="header-n110">
<span id="id3"></span><h3>Q：如何正确将Master和Slave整合进现有业务服务中？<a class="headerlink" href="#header-n110" title="Permalink to this headline">¶</a></h3>
<p>A：比较推荐的一种方式——<strong>将Master/Slave作为类的一个私有属性，整合进类内部</strong>，并且<strong>建议类本身也对生命周期进行妥善管理</strong>（例如设立start、shutdown、join等生命周期管理方法），且建议实现<code class="docutils literal notranslate"><span class="pre">__enter__</span></code>、<code class="docutils literal notranslate"><span class="pre">__exit__</span></code>方法，使得类可以通过<code class="docutils literal notranslate"><span class="pre">with</span></code>进行快速创建和资源回收。</p>
<p>此处<strong>强烈不建议直接对Master和Slave类进行二次继承</strong>，因为这会导致Master/Slave本身的结构和生命周期受到干扰，并且影响其内部的逻辑与数据约束，从而造成不可预期的结果。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>这里说的二次继承是指: MyMaster –&gt; Master, Controller –&gt; MyMaster. Controller作为业务逻辑相关的类应和MyMaster是组合关系，切忌滥用继承。如果要为Master做更多功能拓展的话，也可定义相应的功能类，然后MyMaster多重继承Master和新的功能类。</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, X-Lab.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>