

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Wrapper &amp; Hook Overview &mdash; nerveX 0.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="League Overview" href="league_overview_en.html" />
    <link rel="prev" title="Learner Overview" href="learner_overview.html" />
    <link href="../_static/css/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> nerveX
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concept/index.html">Key Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro_rl/index.html">Introduction to RL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hands_on/index.html">Hands on RL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../best_practice/index.html">Best Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc/index.html">API Doc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Feature</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="algorithm_overview.html">Algorithm Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="policy_overview_en.html">Policy Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_overview_en.html">Model Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_overview_en.html">Env Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="collector_overview_en.html">Collector Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="env_manager_overview_en.html">Env Manager Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="replay_buffer_overview_en.html">Replay Buffer Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="learner_overview.html">Learner Overview</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Wrapper &amp; Hook Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#wrapper">Wrapper</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hook">Hook</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="league_overview_en.html">League Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="hpc_rl_overview_en.html">HPC_RL Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="dataloader_overview.html">DataLoader Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="autolog_overview.html">Autolog Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="interaction_overview_en.html">Interaction Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="loader_overview_en.html">Loader Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../supplementary_rl/index.html">Supplementary of RL</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial_dev/index.html">Tutorial-Developer</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">nerveX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Feature</a> &raquo;</li>
        
      <li>Wrapper &amp; Hook Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/feature/wrapper_hook_overview_en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="wrapper-hook-overview">
<h1>Wrapper &amp; Hook Overview<a class="headerlink" href="#wrapper-hook-overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="wrapper">
<h2>Wrapper<a class="headerlink" href="#wrapper" title="Permalink to this headline">¶</a></h2>
<dl>
<dt>Overview:</dt><dd><p>Wrapper, the decorator. Generally speaking, if we want to perform some custom operations when a certain function is executed, Wrapper can come in handy. Use Wrapper to wrap the function, you can conveniently operate the input and output of the function, or calculate some state related to the function. For model operations, such as <code class="docutils literal notranslate"><span class="pre">.cuda()</span></code> or train/eval mode switching and whether to share the model itself in different modes, it is left to the user to directly adjust the model in the policy.</p>
</dd>
<dt>Usage:</dt><dd><p>There are three places where wrapper is used in nervex: env, model, and learner.</p>
<ul>
<li><p>env</p>
<blockquote>
<div><p>The wrapper used in env is actually a subclass of <code class="docutils literal notranslate"><span class="pre">gym.Wrapper</span></code>. In order to conveniently do some operations or adaptations to the input and output of the environment, Wrapper is a very convenient and effective tool. It can be simply understood that this part of the Wrapper is a wrapper for the environment class. Only some commonly used wrappers in gym are encapsulated in env_wrapper.</p>
<ul>
<li><p>Usage:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;PongNoFrameskip-v4&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">NoopResetEnv</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Define your owned env wrapper. Please complete the following steps to implement customed <code class="docutils literal notranslate"><span class="pre">MyWrapper</span></code> (the same as using <code class="docutils literal notranslate"><span class="pre">gym.Wrapper</span></code>):</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MyWrapper</span></code> inherits <code class="docutils literal notranslate"><span class="pre">gym.Wrapper</span></code>, and implements <code class="docutils literal notranslate"><span class="pre">step()</span></code>, <code class="docutils literal notranslate"><span class="pre">reset()</span></code> and other functions according to requirements.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">=</span> <span class="pre">MyWrapper(env)</span></code> to get a new wrapped environment.</p></li>
</ol>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>model</p>
<blockquote>
<div><p>For the model used in the policy, we also implemented a encapsulation similar to <code class="docutils literal notranslate"><span class="pre">gym.Wrapper</span></code> to achieve faster and more convenient changes to the <code class="docutils literal notranslate"><span class="pre">model</span></code> class.</p>
<ul>
<li><p>Usage:</p>
<blockquote>
<div><p>The defined wrappers are placed under <code class="docutils literal notranslate"><span class="pre">nervex.model.model_wrappers.py</span></code> for easy viewing. For the usage of wrapper, a new model can be obtained according to the following rules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">model_wrap</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">wrapper_name</span><span class="o">=</span><span class="s1">&#39;your_wrapper_name&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt>wrapper can be any wrapper that needs to be used.</dt><dd><ul>
<li><p>Refer to the next section for custom wrapper usage.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">wrapper_name</span></code> is the name of any wrapper that has been registered. If it is a custom wrapper, you need to provide a name when registering.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">kwargs</span></code> is the parameters required by the wrapper.</p></li>
<li><p>In this case, the resulting <code class="docutils literal notranslate"><span class="pre">model</span></code> can be used like the original model. For example, when calling <code class="docutils literal notranslate"><span class="pre">model.forward</span></code>, the <code class="docutils literal notranslate"><span class="pre">forward</span></code> function defined in the wrapper will be called first. If it is not defined, it will continue to look for it in the wrapper of the next layer.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Define your own model wrapper:</p>
<blockquote>
<div><p>For user-defined <code class="docutils literal notranslate"><span class="pre">MyWrapper</span></code>, the following steps need to be completed:</p>
<ol class="arabic simple">
<li><p>Inherit from <code class="docutils literal notranslate"><span class="pre">nervex.model.model_wrappers.IModelWrapper</span></code>, which is the base class of the wrapper used by the model.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">MyWrapper</span></code>, implement the required forward and other functions according to requirements.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">MyWrapper</span></code> to the <code class="docutils literal notranslate"><span class="pre">model_wrappers.wrapper_name_map</span></code> dictionary through the <code class="docutils literal notranslate"><span class="pre">register_wrapper()</span></code> method. In this way, you can easily add wrapper operations to the model through <code class="docutils literal notranslate"><span class="pre">add_wrapper</span></code>.</p></li>
</ol>
</div></blockquote>
</li>
</ul>
<blockquote>
<div><ul>
<li><p>Calling process:</p>
<blockquote>
<div><img alt="../_images/wrapper_structure.jpg" src="../_images/wrapper_structure.jpg" />
<img alt="../_images/wrapper_call.jpg" src="../_images/wrapper_call.jpg" />
</div></blockquote>
</li>
</ul>
</div></blockquote>
<ul>
<li><p>Currently supported wrappers:</p>
<blockquote>
<div><table class="colwidths-given docutils align-default" id="id1">
<caption><span class="caption-text">Accessible Model Wrapper in nerveX</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Wrapper Name</p></th>
<th class="head"><p>Wrapper Class Name</p></th>
<th class="head"><p>Wrapper Usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>base</p></td>
<td><p>BaseModelWrapper</p></td>
<td><p>The most basic wrapper, providing a simple reset method</p></td>
</tr>
<tr class="row-odd"><td><p>hidden_state</p></td>
<td><p>HiddenStateWrapper</p></td>
<td><p>Control the behavior of the hidden state during <code class="docutils literal notranslate"><span class="pre">forward</span></code>, maintain the corresponding hidden state according to the number of training batch samples within the instance, and enter the output hidden of the previous iteration before each <code class="docutils literal notranslate"><span class="pre">forward</span></code>, and save the hidden state of the output after <code class="docutils literal notranslate"><span class="pre">forward</span></code> to prepare for the next time</p></td>
</tr>
<tr class="row-even"><td><p>argmax_sample</p></td>
<td><p>ArgmaxSampleWrapper</p></td>
<td><p>For logit input, find the index where the maximum value is located as an action. Used for discrete actions</p></td>
</tr>
<tr class="row-odd"><td><p>eps_greedy_sample</p></td>
<td><p>EpsGreedySampleWrapper</p></td>
<td><p>For q value input, use Epsilon greedy strategy to sample actions. Used for discrete actions</p></td>
</tr>
<tr class="row-even"><td><p>multinomial_sample</p></td>
<td><p>MultinomialSampleWrapper</p></td>
<td><p>For logit input, sample actions based on probability. Used for discrete actions</p></td>
</tr>
<tr class="row-odd"><td><p>action_noise</p></td>
<td><p>ActionNoiseWrapper</p></td>
<td><p>Add noise of the specified type (such as Gauss, OU) to the action. Used for continuous action</p></td>
</tr>
<tr class="row-even"><td><p>target</p></td>
<td><p>TargetNetworkWrapper</p></td>
<td><p>Used to implement target network</p></td>
</tr>
<tr class="row-odd"><td><p>teacher</p></td>
<td><p>TeacherNetworkWrapper</p></td>
<td><p>Used to implement teacher network</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p>View Wrapper nesting situation</p>
<blockquote>
<div><p>Call the outermost model.info() method to see the nesting status of all wrappers added by the current model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model_wrap</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">wrapper_name</span><span class="o">=</span><span class="s1">&#39;multinomial_sample&#39;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model_wrap</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">wrapper_name</span><span class="o">=</span><span class="s1">&#39;argmax_sample&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;forward&#39;</span><span class="p">))</span> <span class="c1"># 查看forward方法在model中的调用情况</span>
<span class="c1"># MultinomialSampleWrapper ArgmaxSampleWrapper MLP 依次打印出forward方法调用情况</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>learner</p>
<blockquote>
<div><p>There are relatively few places where wrapper is used in the model, which is mainly manifested as the <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">wrapper</span></code> related to timing.</p>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="hook">
<h2>Hook<a class="headerlink" href="#hook" title="Permalink to this headline">¶</a></h2>
<p>Overview:</p>
<blockquote>
<div><p>Hook can automatically call the function defined in the hook when the external function is called. In the program, for a well-encapsulated code, if it needs to be modified, it may take considerable effort. The Hook function was created from this. The code author can expose the hook at any position in a piece of code, and the user can implement the functions they need in the hook, so that when the code runs to the specified position, the hook will be triggered and the functions defined in the hook will be Automatic call, so as to realize the function of quickly modifying the code.</p>
</div></blockquote>
<p>Usage:</p>
<blockquote>
<div><p>The hook used in nervex is mainly in learner.</p>
<ul>
<li><p>learner</p>
<blockquote>
<div><p>In nervex, the training part of the learner can be simplified as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># before_run</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
    <span class="c1"># before_iter</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_policy</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># after_iter</span>
<span class="c1"># after_run</span>
</pre></div>
</div>
<p>As can be seen from the code, the hook used in the learner defines four positions, namely</p>
<blockquote>
<div><ul class="simple">
<li><p>before_run: before the start of the training task</p></li>
<li><p>after_run: After the training task is completed</p></li>
<li><p>before_iter: before each iter of the training task</p></li>
<li><p>after_iter: after each iter of the training task</p></li>
</ul>
</div></blockquote>
<p>When the program runs to the specified location, all functions on the hook registered at this location will be called.</p>
<ul>
<li><p>Usage:</p>
<blockquote>
<div><p>Nervex has implemented many commonly used hooks and provides simple calling methods. The hook can be called through cfg. The configuration and use of cfg are as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># hook:</span>
<span class="c1">#     load_ckpt:</span>
<span class="c1">#         name: load_ckpt # hook的名称</span>
<span class="c1">#         position: before_run # hook所处的位置</span>
<span class="c1">#         priority: 20    # hook的优先级，如果同一位置被注册了多个hook，则会根据优先级大小来顺序执行</span>
<span class="c1">#         type: load_ckpt # hook的类型</span>
<span class="c1">#     log_show:</span>
<span class="c1">#         ext_args:</span>
<span class="c1">#             freq: 100   # 提供了参数freq来控制hook被执行的频率</span>
<span class="c1">#         name: log_show</span>
<span class="c1">#         position: after_iter</span>
<span class="c1">#         priority: 20</span>
<span class="c1">#         type:log_show</span>
<span class="c1">#     save_ckpt_after_iter:</span>
<span class="c1">#         ext_args:</span>
<span class="c1">#             freq: 100</span>
<span class="c1">#         name: save_ckpt_after_iter</span>
<span class="c1">#         position: after_iter</span>
<span class="c1">#         priority: 20</span>
<span class="c1">#         type: save_ckpt</span>
<span class="c1">#     save_ckpt_after_run:</span>
<span class="c1">#         name: save_ckpt_after_run</span>
<span class="c1">#         position: after_run</span>
<span class="c1">#         priority: 20</span>
<span class="c1">#         type: save_ckpt</span>
<span class="n">hooks</span> <span class="o">=</span> <span class="n">build_learner_hook_by_cfg</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>
</div>
<p>So far, nervex will automatically register hooks according to the content of cfg when initializing learner to ensure that related functions can be performed normally.</p>
</div></blockquote>
</li>
</ul>
<blockquote>
<div><ul>
<li><p>Define your own hook: For custom <code class="docutils literal notranslate"><span class="pre">MyHook</span></code>, you need to complete the following steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Inherit <code class="docutils literal notranslate"><span class="pre">nervex.worker.learner.learner_hook.LearnerHook</span></code>. This class is the base class of all hooks used in learner.</p></li>
<li><p>Implement the <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method in <code class="docutils literal notranslate"><span class="pre">MyHook</span></code>. The input of the <code class="docutils literal notranslate"><span class="pre">__call__</span></code> method is an instance of learner. Through this instance, hook can operate on any variable in learner.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">register_learner_hook()</span></code> to register the custom <code class="docutils literal notranslate"><span class="pre">MyHook</span></code>, you need to provide the hook name.</p></li>
<li><p>Now you can use the customized <code class="docutils literal notranslate"><span class="pre">MyHook</span></code> in cfg.</p></li>
</ol>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<ul>
<li><p>Calling process:</p>
<blockquote>
<div><img alt="../_images/hook_call.jpg" src="../_images/hook_call.jpg" />
</div></blockquote>
</li>
<li><p>Currently supported hooks:</p>
<blockquote>
<div><table class="colwidths-given docutils align-default" id="id2">
<caption><span class="caption-text">Accessible Hook in nerveX</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Hook Name</p></th>
<th class="head"><p>Hook Class Name</p></th>
<th class="head"><p>Hook Usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>load_ckpt</p></td>
<td><p>LoadCkptHook</p></td>
<td><p>Load the model from checkpoint</p></td>
</tr>
<tr class="row-odd"><td><p>save_ckpt</p></td>
<td><p>SaveCkptHook</p></td>
<td><p>Save model to checkpoint</p></td>
</tr>
<tr class="row-even"><td><p>log_show</p></td>
<td><p>LogShowHook</p></td>
<td><p>Print log</p></td>
</tr>
<tr class="row-odd"><td><p>log_reduce</p></td>
<td><p>LogReduceHook</p></td>
<td><p>Processing log</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p>Simplified calling hook:</p>
<blockquote>
<div><p>Due to the complex parameters of the hook mentioned earlier, which is not conducive for beginners to get started, nervex provides a simpler calling method:</p>
<table class="colwidths-given docutils align-default" id="id3">
<caption><span class="caption-text">Simplified Hook in nerveX</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Hook Name</p></th>
<th class="head"><p>Params</p></th>
<th class="head"><p>Hook Usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>log_show_after_iter</p></td>
<td><p>freq</p></td>
<td><p>Print log after a certain number of iters according to the <code class="docutils literal notranslate"><span class="pre">freq</span></code> given by the parameter</p></td>
</tr>
<tr class="row-odd"><td><p>load_ckpt_before_run</p></td>
<td><p>None</p></td>
<td><p>Read the checkpoint before the training program runs</p></td>
</tr>
<tr class="row-even"><td><p>save_ckpt_after_iter</p></td>
<td><p>freq</p></td>
<td><p>Save the model after a certain number of iters according to the <code class="docutils literal notranslate"><span class="pre">freq</span></code> given by the parameter</p></td>
</tr>
<tr class="row-odd"><td><p>save_ckpt_after_run</p></td>
<td><p>None</p></td>
<td><p>Save the model after the training program has run completely</p></td>
</tr>
</tbody>
</table>
<p>The calling method is also simpler, and the required hooks can be obtained by the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hook_cfg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">save_ckpt_after_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="c1"># A hook named save_ckpt is added to the after_iter position, ckpt will be saved every 20 iters</span>
    <span class="n">save_ckpt_after_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># A hook named save_ckpt is added at the after_run position, and ckpt will be saved once when the training is completed</span>
<span class="p">)</span>
<span class="n">hooks</span> <span class="o">=</span> <span class="n">build_learner_hook_by_cfg</span><span class="p">(</span><span class="n">hook_cfg</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>View status of the calling of hooks:</p>
<blockquote>
<div><p>NerveX provides the <code class="docutils literal notranslate"><span class="pre">show_hooks()</span></code> method in order to view the status of the calling of hooks at various locations, as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nervex.worker.learner.learner_hook</span> <span class="kn">import</span> <span class="n">show_hooks</span>
<span class="kn">from</span> <span class="nn">nervex.worker.learner</span> <span class="kn">import</span> <span class="n">build_learner_hook_by_cfg</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">save_ckpt_after_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">save_ckpt_after_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hooks</span> <span class="o">=</span> <span class="n">build_learner_hook_by_cfg</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">show_hooks</span><span class="p">(</span><span class="n">hooks</span><span class="p">)</span>
<span class="c1"># before_run: []</span>
<span class="c1"># after_run: [&#39;SaveCkptHook&#39;]</span>
<span class="c1"># before_iter: []</span>
<span class="c1"># after_iter: [&#39;SaveCkptHook&#39;]</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>What is the difference between Wrapper and Hook?</p>
<ul class="simple">
<li><p>Wrapper is an encapsulation of the original method and supports layer-by-layer reuse. If the corresponding method is not found in the current layer, it will be searched on a higher layer.</p></li>
<li><p>Hook is to insert a new method in a certain position on the basis of the original method.</p></li>
</ul>
<img alt="../_images/wrapper_hook_call.jpg" src="../_images/wrapper_hook_call.jpg" />
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="league_overview_en.html" class="btn btn-neutral float-right" title="League Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="learner_overview.html" class="btn btn-neutral float-left" title="Learner Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, X-Lab.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>